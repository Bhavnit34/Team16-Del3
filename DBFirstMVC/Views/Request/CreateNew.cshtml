@model DBFirstMVC.Models.CreateNewRequest

@{
    ViewBag.Title = "CreateNew";
}

<h2>CreateNew</h2>
 @using (Html.BeginForm("CreateRequest","Request",FormMethod.Post)) {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true)
        <div class="generalRequest">
       

                    <fieldset>
                        <legend>Request</legend>

                        <div class="editor-label">
                            @Html.LabelFor(model => model.Request.ModCode, "Module")
                        </div>
                        <div class="editor-field">
                            <!--@Html.DropDownList("ModCode","--Select Module--")-->
                            @Html.DropDownListFor(model => model.Request.ModCode,new SelectList(ViewBag.Modules, "ModCode", "Title"))
                            @Html.ValidationMessageFor(model => model.Request.ModCode)
                        </div>

                        <div class="editor-label">
                            @Html.LabelFor(model => model.Request.SessionType, "Session Type")
                        </div>
                        <div class="editor-field">     
                            <label>@Html.RadioButtonFor(model => model.Request.SessionType, "Lecture", true ) Lecture</label>
                            <label>@Html.RadioButtonFor(model => model.Request.SessionType, "Tutorial", false) Tutorial</label> 
    
                            @Html.ValidationMessageFor(model => model.Request.SessionType)
                        </div>

                         <div class="editor-label">
                            @Html.LabelFor(model => model.Request.DayID, "Day")
                        </div>
                        <div class="editor-field">
                        @{
                            List<SelectListItem> listItems= new List<SelectListItem>();
                            listItems.Add(new SelectListItem
                                {
                                    Text = "Monday", Value = "1"
                                });

                            listItems.Add(new SelectListItem
                            {
                                Text = "Tuesday", Value = "2"
                            });
                            listItems.Add(new SelectListItem
                                {
                                    Text = "Wednesday", Value = "3"
                                });
                            listItems.Add(new SelectListItem
                            {
                                Text = "Thursday", Value = "4"
                            });
                            listItems.Add(new SelectListItem
                            {
                                Text = "Friday", Value = "5"
                            });  
                
                        
                        }

                        @Html.DropDownListFor(model => model.Request.DayID, listItems, "-- Select Day --")

                            @Html.ValidationMessageFor(model => model.Request.DayID)
                        </div>

                        <div class="editor-label">
                            @Html.LabelFor(model => model.Request.PeriodID, "Period")
                        </div>
                        <div class="editor-field">
                            @Html.EditorFor(model => model.Request.PeriodID)
                            @Html.ValidationMessageFor(model => model.Request.PeriodID)
                        </div>

                         <div class="editor-label">
                            @Html.LabelFor(model => model.Request.SessionLength)
                        </div>
                        <div class="editor-field">
                            @Html.EditorFor(model => model.Request.SessionLength)
                            @Html.ValidationMessageFor(model => model.Request.SessionLength)
                        </div>

                        <div class="editor-label">
                            @Html.LabelFor(model => model.Request.PriorityRequest)
                        </div>
                        <div class="editor-field">
                            <!--<input type="checkbox" id="cbPriorityRequest" /> -->
                            @Html.CheckBox("cbPriorityRequest")
                            @Html.ValidationMessageFor(model => model.Request.PriorityRequest)
                        </div>

                        <div class="editor-label">
                            @Html.LabelFor(model => model.Request.SpecialRequirements)
                        </div>
                        <div class="editor-field">
                            @Html.EditorFor(model => model.Request.SpecialRequirements)
                            @Html.ValidationMessageFor(model => model.Request.SpecialRequirements)
                        </div>
                    </fieldset>
                
    
                <div>
                    @Html.ActionLink("Back to List", "Index")
                </div>
        </div>
 
        <div class="generalRequest">
                    <fieldset>
                        <legend>Request</legend>

                        <div class="editor-label">
                            @Html.LabelFor(model => model.Request.ModCode, "Facilites")
                        </div>
                        <div class="editor-field">
                            @Html.DropDownList("Facility","--Select Facility--")
                            @Html.ValidationMessageFor(model => model.Parks)
                    
                        </div>
                        <div>
                            @foreach (var item in Model.Facilities) {
                                <input type="checkbox" name="facList"  value="@item.FacilityName" id="fac@(item.FacilityID)"> @item.FacilityName<br />
                            }
                    
                        </div>                                  

                    </fieldset>
         
        </div>
        <div class="generalRequest">


                    <fieldset>
                        <legend>Request</legend>

                        <div class="editor-label">
                            @Html.LabelFor(model => model.Parks, "Park")
                        </div>
                        <div class="editor-field">
                            @Html.DropDownList("Park","--Select Park--")
                            @Html.ValidationMessageFor(model => model.Parks)
                    
                        </div>
                        <select id="Building"></select><br /><!-- this will dynamically altered -->
                        <select id="Room"></select><br /><!-- this will dynamically altered -->
                        <input type="button" id="btnAddToRoom" value="Add To List" />
                        <div id="listOfRoomsDiv"><table id="listOfRooms"></table></div> <!-- this will dynamically altered -->

                    </fieldset>
         
         
        </div>
        <p>
            <input type="submit" value="Create" />
        </p>
}



@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
@section MyScripts{
    <script type="text/javascript">
        $(document).ready(function () {
            $('#Building').hide();
            $('#Room').hide();
            $('#btnAddToRoom').hide();
        });


        //Function to add the list of buildings based on park choice
        $("#Park").on('change', function () {
            var park = $(this).val();
            $('#Room').hide(200);
            $('#btnAddToRoom').hide();
            if (park.substr(0, 1) == '') { //Check that the --Select Park-- hasnt been clicked
                $('#Building').hide(200);
                return;
            }

            $.post('@Url.Action("GetBuildings", "Request")', { chosenPark: park }, function (data) {
            // Postback response of buildings
            var buildings = data;
            html = "";
            //create a dropdown list of buildings
            for (var i = 0; i < buildings.length; i++) {
                if (buildings[i] != park)
                    html += "<option id='" + buildings[i] + "' value='" + buildings[i] + "'>" + buildings[i] + "</option>";
            }
            $('#Building').html(html); //add this html to the tag
            $('#Building').show(200);
            });  //end $.post
        }); //end function


        //Function to add the list of rooms based on building choice
        $("#Building").on('change', function () {
            var building = $(this).val();

            $.post('@Url.Action("GetRooms", "Request")', { chosenBuilding: building }, function (data) {
                // Postback response of rooms
                var rooms = data;
                html = "";
                //create a dropdown list of rooms
                for (var i = 0; i < rooms.length; i++) {
                        html += "<option id='" + rooms[i] + "' value='" + rooms[i] + "'>" + rooms[i] + "</option>";
                }
                $('#Room').html(html); //add this html to the tag
                $('#Room').show(200);
                $('#btnAddToRoom').show(200);
            });  //end $.post
        }); //end function


        //Function to add a room to the displayed list of chosen rooms
        $('#btnAddToRoom').click(function(){
            var room = $('#Room').val();
            var roomID = room.replace(/\./g,'');
            var len = $('#listOfRooms').children().children().length;

            //return if they have picked 3 rooms
            if (len > 2)
                return;


            //Check that the room doesnt already exist in the list
            for (var i = 0; i < len; i+=2) {
                if ($('#listOfRooms').children().children().eq(i).attr('id') == roomID)
                    return;
            }

            //Create html for the room item and add it to the list
            var html = "<tr id='" + roomID + "'>";
            //we need to add this hidden input so that we can pass the room value to the controller
            html+= "<input type='hidden' id='"+roomID+"' name='chosenRooms' value='"+room+"' />";
            html += "<td>" + room + "</td>";
            html += "<td><img src='/Images/delete.png' id='del"+roomID+"' onclick='deleteRoom(this.id);' height='15' width='15'/></td>";
            html += "</tr>";
            $('#listOfRooms').append(html);
            $('#listOfRoomsDiv').show();
        });


        //Function to delete the room chosen
        function deleteRoom(id) {
            id = id.substr(3, id.length); //change 'delJB021' to 'JB021'
            $('#' + id).remove(); //remove the html <tr> element
        }



    </script>

}


